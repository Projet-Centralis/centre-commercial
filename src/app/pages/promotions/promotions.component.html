<div class="promotions-container">

  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <div class="header-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
        </svg>
      </div>
      <div>
        <h1 class="header-title">Promotions</h1>
        <p class="header-subtitle">{{ promotions.length }} offre{{ promotions.length > 1 ? 's' : '' }} active{{ promotions.length > 1 ? 's' : '' }}</p>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <div class="loader-track">
      <div class="loader-bar"></div>
    </div>
    <p class="loading-text">Chargement des promotions...</p>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!isLoading && promotions.length === 0">
    <div class="empty-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
      </svg>
    </div>
    <p class="empty-title">Aucune promotion disponible</p>
    <p class="empty-subtitle">Les offres actives apparaîtront ici</p>
  </div>

  <!-- Promotions Scroll Track -->
  <div class="scroll-wrapper" *ngIf="!isLoading && promotions.length > 0">
    <button class="scroll-btn scroll-left" (click)="scrollLeft()" [class.hidden]="scrollPosition <= 0">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <polyline points="15 18 9 12 15 6"/>
      </svg>
    </button>

    <div class="cards-track" #cardsTrack (scroll)="onScroll($event)">
      <div class="promo-card" *ngFor="let promo of promotions; let i = index"
           [class.card-inactive]="!promo.actif"
           [style.animation-delay]="i * 80 + 'ms'">

        <!-- Discount Badge -->
        <div class="discount-badge">
          <span class="discount-value">-{{ promo.pourcentage_reduction }}%</span>
        </div>

        <!-- Status Pill -->
        <div class="status-pill" [class.status-active]="promo.actif" [class.status-inactive]="!promo.actif">
          <span class="status-dot"></span>
          {{ promo.actif ? 'Active' : 'Inactive' }}
        </div>

        <!-- Product Image -->
        <div class="product-image-area">
          <img
            *ngIf="promo.produit.images && promo.produit.images.length > 0"
            [src]="'/' + promo.produit.images[0]"
            [alt]="promo.produit.nom_produit"
            class="product-img"
            (error)="onImageError($event)"
          />
          <div class="product-image-fallback" *ngIf="!promo.produit.images || promo.produit.images.length === 0">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <circle cx="8.5" cy="8.5" r="1.5"/>
              <polyline points="21 15 16 10 5 21"/>
            </svg>
          </div>
          <div class="card-glow"></div>
        </div>

        <!-- Card Body -->
        <div class="card-body">
          <p class="product-category">Produit</p>
          <h3 class="product-name">{{ promo.produit.nom_produit }}</h3>

          <div class="divider"></div>

          <h4 class="promo-title">{{ promo.titre }}</h4>
          <p class="promo-desc">{{ promo.description }}</p>

          <!-- Pricing -->
          <div class="pricing-row">
            <div class="price-group">
              <span class="price-label">Prix original</span>
              <span class="price-original">{{ promo.produit.prix | currency:'EUR':'symbol':'1.0-0' }}</span>
            </div>
            <div class="price-arrow">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="5" y1="12" x2="19" y2="12"/>
                <polyline points="12 5 19 12 12 19"/>
              </svg>
            </div>
            <div class="price-group">
              <span class="price-label">Prix promo</span>
              <span class="price-promo">{{ promo.produit.prix_promotionnel | currency:'EUR':'symbol':'1.0-0' }}</span>
            </div>
          </div>

          <!-- Date Range -->
          <div class="date-range">
            <div class="date-item">
              <svg class="date-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
              </svg>
              <div>
                <span class="date-label">Début</span>
                <span class="date-value">{{ promo.date_debut | date:'dd MMM yyyy' }}</span>
              </div>
            </div>
            <div class="date-separator"></div>
            <div class="date-item">
              <svg class="date-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              <div>
                <span class="date-label">Fin</span>
                <span class="date-value">{{ promo.date_fin | date:'dd MMM yyyy' }}</span>
              </div>
            </div>
          </div>

          <!-- Stock Info -->
          <div class="stock-info">
            <div class="stock-bar-wrap">
              <div class="stock-bar-fill"
                [style.width]="getStockPercent(promo.produit) + '%'"
                [class.stock-low]="isStockLow(promo.produit)">
              </div>
            </div>
            <span class="stock-label">
              Stock : {{ promo.produit.quantite_stock }}
              <span class="stock-alert" *ngIf="isStockLow(promo.produit)"> ⚠ Faible</span>
            </span>
          </div>
        </div>
      </div>
    </div>

    <button class="scroll-btn scroll-right" (click)="scrollRight()" [class.hidden]="isScrollEnd">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <polyline points="9 18 15 12 9 6"/>
      </svg>
    </button>
  </div>

  <!-- Scroll Dots -->
  <div class="scroll-dots" *ngIf="promotions.length > 1">
    <span class="dot" *ngFor="let p of promotions; let i = index"
          [class.dot-active]="activeIndex === i"
          (click)="scrollToCard(i)">
    </span>
  </div>

</div>