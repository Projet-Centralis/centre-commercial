<header class="header">
  <div class="left">
    <img src="/logo.png" alt="Logo" class="logo">
    <div class="brand-text">
      <h1>Centre Commercial</h1>
      <p>Votre espace {{ getUserTypeText() | lowercase }}</p>
    </div>
  </div>

  <div class="right">

    <div class="notification-wrapper" *ngIf="isAuthenticated">
      <div class="notification-icon" (click)="toggleNotifPanel()">
        <i class="bi bi-bell"></i>
        <span class="notification-badge" *ngIf="unreadCount > 0">{{ unreadCount }}</span>
      </div>

      <!-- PANEL NOTIFICATIONS -->
      <div class="notif-panel" *ngIf="showPanel">
        <div class="notif-panel-header">
          <span>Notifications</span>
          <span class="notif-count-label" *ngIf="unreadCount > 0">{{ unreadCount }} non lue(s)</span>
        </div>

        <div class="notif-empty" *ngIf="notifications.length === 0">
          Aucune notification pour le moment.
        </div>

        <div class="notif-list">
          <div
            class="notif-item"
            *ngFor="let notif of notifications"
            [class.unread]="!notif.read"
          >
            <div class="notif-item-icon">
              <i class="bi bi-bell-fill"></i>
            </div>
            <div class="notif-item-body">
              <div class="notif-item-title">{{ notif.titre }}</div>
              <div class="notif-item-message">{{ notif.message }}</div>
              <div class="notif-item-date">{{ notif.createdAt | date:'dd/MM/yyyy HH:mm' }}</div>
            </div>
            <span class="notif-dot" *ngIf="!notif.read"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- USER -->
    <div class="user-info" *ngIf="isAuthenticated">
      <div class="user-details">
        <div class="user-name">{{ userName }}</div>
        <div class="user-type-badge" [ngClass]="userType.toLowerCase()">
          {{ getUserTypeText() }}
        </div>
      </div>
      <button class="logout-btn" (click)="logout()">
        <i class="bi bi-box-arrow-right"></i>
        <span>Déconnexion</span>
      </button>
    </div>

    <div class="auth-buttons" *ngIf="!isAuthenticated">
      <a routerLink="/auth" class="login-btn">
        <i class="bi bi-box-arrow-in-right"></i>
        <span>Connexion</span>
      </a>
    </div>
  </div>
</header>

<!-- overlay transparent pour fermer le panel en cliquant ailleurs -->
<div class="notif-overlay" *ngIf="showPanel" (click)="showPanel = false"></div>

<!-- Toast auto (nouvelle notif reçue par polling) -->
<div class="notif-toast" *ngIf="showToast">
  <div class="toast-body">
    <div class="toast-title">{{ toastMessage.titre }}</div>
    <div class="toast-msg">{{ toastMessage.message }}</div>
  </div>
</div>